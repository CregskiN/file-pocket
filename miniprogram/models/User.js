"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", { value: true });
var https_1 = require("../utils/https");
var User = (function () {
    function User() {
    }
    User.login = function () {
        return new Promise(function (resolve, reject) {
            wx.checkSession({
                success: function (res) {
                    if (res.errMsg === 'checkSession:ok') {
                        resolve(wx.getStorageSync('OPENID_SESSIONKEY'));
                    }
                },
                fail: function (err) {
                    wx.login({
                        success: function (res) {
                            var data = { code: res.code };
                            var loginRes = https_1.request('/wxma_auth/code_to_session', 'POST', data);
                            loginRes.then(function (res) {
                                var openidWithSessionKey = res.data;
                                wx.setStorageSync('OPENID_SESSIONKEY', openidWithSessionKey);
                                resolve(openidWithSessionKey);
                            }).catch(function (err) {
                                console.log('login逻辑有误 - ', err);
                                reject(err);
                            });
                        },
                        fail: function (err) {
                            reject(err);
                        }
                    });
                }
            });
        });
    };
    User.getAuthorize = function () {
        return new Promise(function (resolve, reject) {
            wx.getSetting({
                success: function (res) {
                    console.log(res);
                    if (res.authSetting['scope.userInfo']) {
                        var userInfo = null;
                        var userInfoStorage = wx.getStorageSync('USERINFO');
                        if (userInfoStorage) {
                            userInfo = userInfoStorage;
                            resolve(userInfo);
                            return;
                        }
                        else {
                            wx.getUserInfo({
                                success: function (res) {
                                    resolve(res.userInfo);
                                    return;
                                },
                                fail: function (err) {
                                    reject(err);
                                    return;
                                }
                            });
                        }
                    }
                    else if (!res.authSetting['scope.userInfo']) {
                        resolve({});
                    }
                },
                fail: function (err) {
                    reject(err);
                    return;
                }
            });
        });
    };
    User.getUserInfo = function () {
        try {
            var userInfo = wx.getStorageSync('userInfo');
            if (userInfo !== '') {
                userInfo = JSON.parse(userInfo);
            }
            else {
                userInfo = {};
            }
            return userInfo.userInfo;
        }
        catch (err) {
            console.log(err);
            return {};
        }
    };
    User.setUserInfo = function (userInfo) {
        try {
            var oldInfo = this.getUserInfo() || {};
            var newUserInfo = __assign(__assign({}, oldInfo), { userInfo: userInfo });
            wx.setStorageSync('userInfo', JSON.stringify(newUserInfo));
        }
        catch (err) {
            console.log(err);
        }
    };
    return User;
}());
exports.default = User;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlVzZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBLHdDQUF5QztBQWV6QztJQUFBO0lBMklBLENBQUM7SUFySVUsVUFBSyxHQUFaO1FBQ0ksT0FBTyxJQUFJLE9BQU8sQ0FBd0IsVUFBQyxPQUFPLEVBQUUsTUFBTTtZQUN0RCxFQUFFLENBQUMsWUFBWSxDQUFDO2dCQUNaLE9BQU8sRUFBRSxVQUFDLEdBQUc7b0JBQ1QsSUFBSSxHQUFHLENBQUMsTUFBTSxLQUFLLGlCQUFpQixFQUFFO3dCQUNsQyxPQUFPLENBQUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUM7cUJBQ25EO2dCQUNMLENBQUM7Z0JBQ0QsSUFBSSxFQUFFLFVBQUMsR0FBRztvQkFDTixFQUFFLENBQUMsS0FBSyxDQUFDO3dCQUNMLE9BQU8sRUFBRSxVQUFDLEdBQUc7NEJBQ1QsSUFBTSxJQUFJLEdBQUcsRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDOzRCQUNoQyxJQUFNLFFBQVEsR0FBRyxlQUFPLENBQXNELDRCQUE0QixFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQzs0QkFDMUgsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFBLEdBQUc7Z0NBRWIsSUFBTSxvQkFBb0IsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO2dDQUN0QyxFQUFFLENBQUMsY0FBYyxDQUFDLG1CQUFtQixFQUFFLG9CQUFvQixDQUFDLENBQUM7Z0NBQzdELE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDOzRCQUNsQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBQSxHQUFHO2dDQUNSLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dDQUNqQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUE7NEJBQ2YsQ0FBQyxDQUFDLENBQUE7d0JBQ04sQ0FBQzt3QkFDRCxJQUFJLEVBQUUsVUFBQyxHQUFHOzRCQUNOLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQTt3QkFDZixDQUFDO3FCQUNKLENBQUMsQ0FBQTtnQkFDTixDQUFDO2FBQ0osQ0FBQyxDQUFBO1FBQ04sQ0FBQyxDQUFDLENBQUE7SUFDTixDQUFDO0lBS00saUJBQVksR0FBbkI7UUFDSSxPQUFPLElBQUksT0FBTyxDQUFpQixVQUFDLE9BQU8sRUFBRSxNQUFNO1lBQy9DLEVBQUUsQ0FBQyxVQUFVLENBQUM7Z0JBQ1YsT0FBTyxFQUFFLFVBQUMsR0FBRztvQkFDVCxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUNqQixJQUFJLEdBQUcsQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsRUFBRTt3QkFFbkMsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDO3dCQUNwQixJQUFNLGVBQWUsR0FBRyxFQUFFLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO3dCQUN0RCxJQUFJLGVBQWUsRUFBRTs0QkFFakIsUUFBUSxHQUFHLGVBQWUsQ0FBQzs0QkFDM0IsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDOzRCQUNsQixPQUFPO3lCQUNWOzZCQUFNOzRCQUVILEVBQUUsQ0FBQyxXQUFXLENBQUM7Z0NBQ1gsT0FBTyxFQUFFLFVBQUEsR0FBRztvQ0FDUixPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO29DQUN0QixPQUFPO2dDQUNYLENBQUM7Z0NBQ0QsSUFBSSxFQUFFLFVBQUEsR0FBRztvQ0FDTCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7b0NBQ1osT0FBTztnQ0FDWCxDQUFDOzZCQUNKLENBQUMsQ0FBQTt5QkFDTDtxQkFDSjt5QkFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxFQUFFO3dCQUMzQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7cUJBQ2Y7Z0JBQ0wsQ0FBQztnQkFDRCxJQUFJLEVBQUUsVUFBQyxHQUFHO29CQUVOLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDWixPQUFPO2dCQUNYLENBQUM7YUFDSixDQUFDLENBQUE7UUFxQk4sQ0FBQyxDQUFDLENBQUE7SUFFTixDQUFDO0lBT00sZ0JBQVcsR0FBbEI7UUFDSSxJQUFJO1lBQ0EsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDLGNBQWMsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUM3QyxJQUFJLFFBQVEsS0FBSyxFQUFFLEVBQUU7Z0JBQ2pCLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO2FBQ25DO2lCQUFNO2dCQUNILFFBQVEsR0FBRyxFQUFFLENBQUM7YUFDakI7WUFDRCxPQUFPLFFBQVEsQ0FBQyxRQUFRLENBQUM7U0FDNUI7UUFBQyxPQUFPLEdBQUcsRUFBRTtZQUNWLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDakIsT0FBTyxFQUFFLENBQUM7U0FDYjtJQUNMLENBQUM7SUFNTSxnQkFBVyxHQUFsQixVQUFtQixRQUFvQztRQUNuRCxJQUFJO1lBQ0EsSUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxJQUFJLEVBQUUsQ0FBQztZQUN6QyxJQUFNLFdBQVcseUJBQ1YsT0FBTyxLQUNWLFFBQVEsVUFBQSxHQUNYLENBQUE7WUFDRCxFQUFFLENBQUMsY0FBYyxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7U0FDOUQ7UUFBQyxPQUFPLEdBQUcsRUFBRTtZQUNWLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDcEI7SUFFTCxDQUFDO0lBQ0wsV0FBQztBQUFELENBQUMsQUEzSUQsSUEySUM7QUFJRCxrQkFBZSxJQUFJLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyByZXF1ZXN0IH0gZnJvbSAnLi4vdXRpbHMvaHR0cHMnO1xuXG5pbXBvcnQgeyBPcGVuaWRfU2Vzc2lvbktleVR5cGUsIEN1c3RvbVVzZXJJbmZvIH0gZnJvbSAnLi4vdXRpbHMvdHlwaW5nJztcblxuXG5pbnRlcmZhY2UgR2V0VXNlckluZm9SZXN1bHQge1xuICAgIGF2YXRhclVybD86IHN0cmluZztcbiAgICBjaXR5Pzogc3RyaW5nO1xuICAgIGNvdW50cnk/OiBzdHJpbmc7XG4gICAgZ2VuZGVyPzogMCB8IDEgfCAyO1xuICAgIGxhbmd1YWdlPzogJ2VuJyB8ICd6aF9DTicgfCAnemhfVFcnO1xuICAgIG5pY2tOYW1lPzogc3RyaW5nO1xuICAgIHByb3ZpbmNlPzogc3RyaW5nO1xufVxuXG5jbGFzcyBVc2VyIHtcblxuXG4gICAgLyoqXG4gICAgICog55m76ZmG77yaIHd4LmNoZWNrU2Vzc2lvbuajgOafpeaYr+WQpui/h+acnyDvvJ8gd3gubG9naW4gKyDliqDlhaXnvJPlrZggOiDku47nvJPlrZjmj5Dlj5ZvcGVuaWQgKyBzZXNzaW9uX2tleVxuICAgICAqL1xuICAgIHN0YXRpYyBsb2dpbigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPE9wZW5pZF9TZXNzaW9uS2V5VHlwZT4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgd3guY2hlY2tTZXNzaW9uKHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXMuZXJyTXNnID09PSAnY2hlY2tTZXNzaW9uOm9rJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh3eC5nZXRTdG9yYWdlU3luYygnT1BFTklEX1NFU1NJT05LRVknKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZhaWw6IChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgd3gubG9naW4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB7IGNvZGU6IHJlcy5jb2RlIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9naW5SZXMgPSByZXF1ZXN0PFJlcXVlc3QuQ29kZVRvU2Vzc2lvblJlcSwgUmVzcG9uc2UuQ29kZVRvU2Vzc2lvblJlcz4oJy93eG1hX2F1dGgvY29kZV90b19zZXNzaW9uJywgJ1BPU1QnLCBkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dpblJlcy50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOatpOWkhOW6lOivpeagoemqjHJlc+aYr+WQpuWQiOazlVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvcGVuaWRXaXRoU2Vzc2lvbktleSA9IHJlcy5kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3eC5zZXRTdG9yYWdlU3luYygnT1BFTklEX1NFU1NJT05LRVknLCBvcGVuaWRXaXRoU2Vzc2lvbktleSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob3BlbmlkV2l0aFNlc3Npb25LZXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsb2dpbumAu+i+keacieivryAtICcsIGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBmYWlsOiAoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycilcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOiOt+WPluaOiOadg+S/oeaBr1xuICAgICAqL1xuICAgIHN0YXRpYyBnZXRBdXRob3JpemUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxDdXN0b21Vc2VySW5mbz4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgd3guZ2V0U2V0dGluZyh7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzLmF1dGhTZXR0aW5nWydzY29wZS51c2VySW5mbyddKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlt7LmjojmnYPlpITnkIblpoLkuItcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB1c2VySW5mbyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1c2VySW5mb1N0b3JhZ2UgPSB3eC5nZXRTdG9yYWdlU3luYygnVVNFUklORk8nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VySW5mb1N0b3JhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDlt7LmjojmnYPvvIzkuJTmnInnvJPlrZhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VySW5mbyA9IHVzZXJJbmZvU3RvcmFnZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHVzZXJJbmZvKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOW3sue7j+aOiOadg++8jOS9huaXoOe8k+WtmFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHd4LmdldFVzZXJJbmZvKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogcmVzID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzLnVzZXJJbmZvKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbDogZXJyID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghcmVzLmF1dGhTZXR0aW5nWydzY29wZS51c2VySW5mbyddKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHt9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZmFpbDogKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyDlm6DnvZHnu5zpl67pophcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLy8gLy8g6I635Y+W55So5oi35L+h5oGvXG4gICAgICAgICAgICAvLyB3eC5nZXRTZXR0aW5nKHtcbiAgICAgICAgICAgIC8vIFx0c3VjY2VzczogcmVzID0+IHtcbiAgICAgICAgICAgIC8vIFx0XHRpZiAocmVzLmF1dGhTZXR0aW5nWydzY29wZS51c2VySW5mbyddKSB7XG4gICAgICAgICAgICAvLyBcdFx0XHQvLyDlt7Lnu4/mjojmnYPvvIzlj6/ku6Xnm7TmjqXosIPnlKggZ2V0VXNlckluZm8g6I635Y+W5aS05YOP5pi156ew77yM5LiN5Lya5by55qGGXG4gICAgICAgICAgICAvLyBcdFx0XHR3eC5nZXRVc2VySW5mbyh7XG4gICAgICAgICAgICAvLyBcdFx0XHRcdHN1Y2Nlc3M6IHJlcyA9PiB7XG4gICAgICAgICAgICAvLyBcdFx0XHRcdFx0Ly8g5Y+v5Lul5bCGIHJlcyDlj5HpgIHnu5nlkI7lj7Dop6PnoIHlh7ogdW5pb25JZFxuICAgICAgICAgICAgLy8gXHRcdFx0XHRcdHRoaXMuZ2xvYmFsRGF0YS51c2VySW5mbyA9IHJlcy51c2VySW5mb1xuXG4gICAgICAgICAgICAvLyBcdFx0XHRcdFx0Ly8g55Sx5LqOIGdldFVzZXJJbmZvIOaYr+e9kee7nOivt+axgu+8jOWPr+iDveS8muWcqCBQYWdlLm9uTG9hZCDkuYvlkI7miY3ov5Tlm55cbiAgICAgICAgICAgIC8vIFx0XHRcdFx0XHQvLyDmiYDku6XmraTlpITliqDlhaUgY2FsbGJhY2sg5Lul6Ziy5q2i6L+Z56eN5oOF5Ya1XG4gICAgICAgICAgICAvLyBcdFx0XHRcdFx0aWYgKHRoaXMudXNlckluZm9SZWFkeUNhbGxiYWNrKSB7XG4gICAgICAgICAgICAvLyBcdFx0XHRcdFx0XHR0aGlzLnVzZXJJbmZvUmVhZHlDYWxsYmFjayhyZXMpXG4gICAgICAgICAgICAvLyBcdFx0XHRcdFx0fVxuICAgICAgICAgICAgLy8gXHRcdFx0XHR9LFxuICAgICAgICAgICAgLy8gXHRcdFx0fSlcbiAgICAgICAgICAgIC8vIFx0XHR9XG4gICAgICAgICAgICAvLyBcdH0sXG4gICAgICAgICAgICAvLyB9KVxuICAgICAgICB9KVxuXG4gICAgfVxuXG5cblxuICAgIC8qKlxuICAgICAqIOaPkOWPlue8k+WtmOS4reeahHVzZXJJbmZvKOS4jeWMheaLrG9wZW5faWQpXG4gICAgICovXG4gICAgc3RhdGljIGdldFVzZXJJbmZvKCk6IEdldFVzZXJJbmZvUmVzdWx0IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGxldCB1c2VySW5mbyA9IHd4LmdldFN0b3JhZ2VTeW5jKCd1c2VySW5mbycpO1xuICAgICAgICAgICAgaWYgKHVzZXJJbmZvICE9PSAnJykge1xuICAgICAgICAgICAgICAgIHVzZXJJbmZvID0gSlNPTi5wYXJzZSh1c2VySW5mbyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHVzZXJJbmZvID0ge307XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdXNlckluZm8udXNlckluZm87XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOWtmOWCqHVzZXJJbmZvKOS4jeWMheaLrG9wZW5faWQp77yM5aKe6YeP5a2Y5YKo44CC57G75Ly85LqOdGhpcy5zZXJEYXRhXG4gICAgICogQHBhcmFtIHVzZXJJbmZvIFxuICAgICAqL1xuICAgIHN0YXRpYyBzZXRVc2VySW5mbyh1c2VySW5mbzogV2VjaGF0TWluaXByb2dyYW0uVXNlckluZm8pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IG9sZEluZm8gPSB0aGlzLmdldFVzZXJJbmZvKCkgfHwge307XG4gICAgICAgICAgICBjb25zdCBuZXdVc2VySW5mbyA9IHtcbiAgICAgICAgICAgICAgICAuLi5vbGRJbmZvLFxuICAgICAgICAgICAgICAgIHVzZXJJbmZvXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3eC5zZXRTdG9yYWdlU3luYygndXNlckluZm8nLCBKU09OLnN0cmluZ2lmeShuZXdVc2VySW5mbykpO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgIH1cblxuICAgIH1cbn1cblxuXG5cbmV4cG9ydCBkZWZhdWx0IFVzZXI7XG4iXX0=