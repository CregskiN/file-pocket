"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var https_1 = __importDefault(require("../utils/https"));
var User = (function () {
    function User() {
    }
    User.login = function () {
        return new Promise(function (resolve, reject) {
            wx.checkSession({
                success: function (res) {
                },
                fail: function (err) {
                },
                complete: function () {
                    wx.login({
                        success: function (res) {
                            console.log('wx.login res', res);
                            var data = { code: res.code };
                            var options = {
                                url: '/wxma_auth/code_to_session',
                                method: 'POST',
                                data: data
                            };
                            var loginRes = https_1.default.request(options);
                            loginRes.then(function (res) {
                                console.log(res);
                                var openid_sessionKey = res.data;
                                console.log('login接口获取的openid_sessionKey', openid_sessionKey);
                                User.setOpenidSessionKeyStorage(openid_sessionKey);
                                resolve(openid_sessionKey);
                            }).catch(function (err) {
                                console.log('login逻辑有误 - ', err);
                                reject(err);
                            });
                        },
                        fail: function (err) {
                            console.log('wx.login接口调用失败', err);
                            reject(err);
                        }
                    });
                }
            });
        });
    };
    User.getAuthorize = function () {
        return new Promise(function (resolve, reject) {
            wx.getSetting({
                success: function (res) {
                    console.log(res);
                    if (res.authSetting['scope.userInfo']) {
                        var userInfo = null;
                        var userInfoStorage = User.getUserInfoStorage();
                        if (userInfoStorage) {
                            userInfo = userInfoStorage;
                            resolve(userInfo);
                            return;
                        }
                        else {
                            wx.getUserInfo({
                                success: function (res) {
                                    resolve(res.userInfo);
                                    return;
                                },
                                fail: function (err) {
                                    reject(err);
                                    return;
                                }
                            });
                        }
                    }
                    else if (!res.authSetting['scope.userInfo']) {
                        resolve({});
                        return;
                    }
                },
                fail: function (err) {
                    reject(err);
                    return;
                }
            });
        });
    };
    User.setUserInfoStorage = function (userInfo) {
        var oUserInfo = this.getUserInfoStorage();
        var nUserInfo = __assign(__assign({}, oUserInfo), userInfo);
        delete nUserInfo['username'];
        wx.setStorageSync('USERINFO', nUserInfo);
    };
    User.getOpenidSessionKeyStorage = function () {
        return wx.getStorageSync('OPENID_SESSIONKEY');
    };
    User.setOpenidSessionKeyStorage = function (openid_sessionKey) {
        var oOpenid_sessionKey = this.getOpenidSessionKeyStorage();
        var nOpenid_sessionKey = __assign(__assign({}, oOpenid_sessionKey), openid_sessionKey);
        wx.setStorageSync('OPENID_SESSIONKEY', nOpenid_sessionKey);
    };
    User.getUserInfoStorage = function () {
        try {
            return wx.getStorageSync('USERINFO');
        }
        catch (err) {
            console.log('USERINFO提取失败', err);
            return {};
        }
    };
    User.getUserInfo = function () {
        try {
            var userInfo = wx.getStorageSync('userInfo');
            if (userInfo !== '') {
                userInfo = JSON.parse(userInfo);
            }
            else {
                userInfo = {};
            }
            return userInfo.userInfo;
        }
        catch (err) {
            console.log(err);
            return {};
        }
    };
    User.setUserInfo = function (userInfo) {
        try {
            var oldInfo = this.getUserInfo() || {};
            var newUserInfo = __assign(__assign({}, oldInfo), { userInfo: userInfo });
            wx.setStorageSync('userInfo', JSON.stringify(newUserInfo));
        }
        catch (err) {
            console.log(err);
        }
    };
    return User;
}());
exports.default = User;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXNlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIlVzZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLHlEQUFtQztBQWVuQztJQUFBO0lBNE1BLENBQUM7SUF0TVUsVUFBSyxHQUFaO1FBQ0ksT0FBTyxJQUFJLE9BQU8sQ0FBd0IsVUFBQyxPQUFPLEVBQUUsTUFBTTtZQUN0RCxFQUFFLENBQUMsWUFBWSxDQUFDO2dCQUNaLE9BQU8sRUFBRSxVQUFDLEdBQUc7Z0JBTWIsQ0FBQztnQkFDRCxJQUFJLEVBQUUsVUFBQyxHQUFHO2dCQUVWLENBQUM7Z0JBQ0QsUUFBUSxFQUFFO29CQUNOLEVBQUUsQ0FBQyxLQUFLLENBQUM7d0JBQ0wsT0FBTyxFQUFFLFVBQUMsR0FBRzs0QkFDVCxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxHQUFHLENBQUMsQ0FBQzs0QkFFakMsSUFBTSxJQUFJLEdBQUcsRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDOzRCQUNoQyxJQUFNLE9BQU8sR0FBRztnQ0FDWixHQUFHLEVBQUUsNEJBQTRCO2dDQUNqQyxNQUFNLEVBQUUsTUFBZ0I7Z0NBQ3hCLElBQUksRUFBRSxJQUFJOzZCQUNiLENBQUE7NEJBQ0QsSUFBTSxRQUFRLEdBQUcsZUFBSyxDQUFDLE9BQU8sQ0FBc0QsT0FBTyxDQUFDLENBQUM7NEJBQzdGLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBQyxHQUFRO2dDQUVuQixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dDQUVqQixJQUFNLGlCQUFpQixHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7Z0NBQ25DLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztnQ0FDOUQsSUFBSSxDQUFDLDBCQUEwQixDQUFDLGlCQUFpQixDQUFDLENBQUM7Z0NBQ25ELE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFD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QUU7WUFDVixPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNqQyxPQUFPLEVBQUUsQ0FBQTtTQUNaO0lBQ0wsQ0FBQztJQUtNLGdCQUFXLEdBQWxCO1FBQ0ksSUFBSTtZQUNBLElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDN0MsSUFBSSxRQUFRLEtBQUssRUFBRSxFQUFFO2dCQUNqQixRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQzthQUNuQztpQkFBTTtnQkFDSCxRQUFRLEdBQUcsRUFBRSxDQUFDO2FBQ2pCO1lBQ0QsT0FBTyxRQUFRLENBQUMsUUFBUSxDQUFDO1NBQzVCO1FBQUMsT0FBTyxHQUFHLEVBQUU7WUFDVixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2pCLE9BQU8sRUFBRSxDQUFDO1NBQ2I7SUFDTCxDQUFDO0lBTU0sZ0JBQVcsR0FBbEIsVUFBbUIsUUFBb0M7UUFDbkQsSUFBSTtZQUNBLElBQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsSUFBSSxFQUFFLENBQUM7WUFDekMsSUFBTSxXQUFXLHlCQUNWLE9BQU8sS0FDVixRQUFRLFVBQUEsR0FDWCxDQUFBO1lBQ0QsRUFBRSxDQUFDLGNBQWMsQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1NBQzlEO1FBQUMsT0FBTyxHQUFHLEVBQUU7WUFDVixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ3BCO0lBRUwsQ0FBQztJQUNMLFdBQUM7QUFBRCxDQUFDLEFBNU1ELElBNE1DO0FBSUQsa0JBQWUsSUFBSSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEh0dHBzIGZyb20gJy4uL3V0aWxzL2h0dHBzJztcblxuaW1wb3J0IHsgT3BlbmlkX1Nlc3Npb25LZXlUeXBlLCBDdXN0b21Vc2VySW5mbyB9IGZyb20gJy4uL3V0aWxzL3R5cGluZyc7XG5cblxuaW50ZXJmYWNlIEdldFVzZXJJbmZvUmVzdWx0IHtcbiAgICBhdmF0YXJVcmw/OiBzdHJpbmc7XG4gICAgY2l0eT86IHN0cmluZztcbiAgICBjb3VudHJ5Pzogc3RyaW5nO1xuICAgIGdlbmRlcj86IDAgfCAxIHwgMjtcbiAgICBsYW5ndWFnZT86ICdlbicgfCAnemhfQ04nIHwgJ3poX1RXJztcbiAgICBuaWNrTmFtZT86IHN0cmluZztcbiAgICBwcm92aW5jZT86IHN0cmluZztcbn1cblxuY2xhc3MgVXNlciB7XG5cblxuICAgIC8qKlxuICAgICAqIOeZu+mZhu+8miB3eC5jaGVja1Nlc3Npb27mo4Dmn6XmmK/lkKbov4fmnJ8g77yfIHd4LmxvZ2luICsg5Yqg5YWl57yT5a2YIDog5LuO57yT5a2Y5o+Q5Y+Wb3BlbmlkICsgc2Vzc2lvbl9rZXlcbiAgICAgKi9cbiAgICBzdGF0aWMgbG9naW4oKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTxPcGVuaWRfU2Vzc2lvbktleVR5cGU+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHd4LmNoZWNrU2Vzc2lvbih7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnd3guY2hlY2tTZXNzaW9u5oiQ5YqfJyxyZXMpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgKHJlcy5lcnJNc2cgPT09ICdjaGVja1Nlc3Npb246b2snKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgICByZXNvbHZlKFVzZXIuZ2V0T3BlbmlkU2Vzc2lvbktleVN0b3JhZ2UoKSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZhaWw6IChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb21wbGV0ZTogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB3eC5sb2dpbih7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3d4LmxvZ2luIHJlcycsIHJlcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0geyBjb2RlOiByZXMuY29kZSB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybDogJy93eG1hX2F1dGgvY29kZV90b19zZXNzaW9uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcgYXMgXCJQT1NUXCIsIC8vIHRz57G75Z6L5o6o5pat5LiN5Ye65p2lXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbG9naW5SZXMgPSBIdHRwcy5yZXF1ZXN0PFJlcXVlc3QuQ29kZVRvU2Vzc2lvblJlcSwgUmVzcG9uc2UuQ29kZVRvU2Vzc2lvblJlcz4ob3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9naW5SZXMudGhlbigocmVzOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5q2k5aSE5bqU6K+l5qCh6aqMcmVz5piv5ZCm5ZCI5rOVXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvcGVuaWRfc2Vzc2lvbktleSA9IHJlcy5kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbG9naW7mjqXlj6Pojrflj5bnmoRvcGVuaWRfc2Vzc2lvbktleScsIG9wZW5pZF9zZXNzaW9uS2V5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVXNlci5zZXRPcGVuaWRTZXNzaW9uS2V5U3RvcmFnZShvcGVuaWRfc2Vzc2lvbktleSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUob3BlbmlkX3Nlc3Npb25LZXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKChlcnI6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbG9naW7pgLvovpHmnInor68gLSAnLCBlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgZmFpbDogKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd3eC5sb2dpbuaOpeWPo+iwg+eUqOWksei0pScsIGVycik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog6I635Y+W5o6I5p2D5L+h5oGvXG4gICAgICovXG4gICAgc3RhdGljIGdldEF1dGhvcml6ZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPEN1c3RvbVVzZXJJbmZvPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB3eC5nZXRTZXR0aW5nKHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHJlcyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXMuYXV0aFNldHRpbmdbJ3Njb3BlLnVzZXJJbmZvJ10pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOW3suaOiOadg+WkhOeQhuWmguS4i1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHVzZXJJbmZvID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJJbmZvU3RvcmFnZSA9IFVzZXIuZ2V0VXNlckluZm9TdG9yYWdlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlckluZm9TdG9yYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5bey5o6I5p2D77yM5LiU5pyJ57yT5a2YXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlckluZm8gPSB1c2VySW5mb1N0b3JhZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh1c2VySW5mbyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyDlt7Lnu4/mjojmnYPvvIzkvYbml6DnvJPlrZhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3eC5nZXRVc2VySW5mbyh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlcy51c2VySW5mbyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWw6IGVyciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIXJlcy5hdXRoU2V0dGluZ1snc2NvcGUudXNlckluZm8nXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh7fSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZhaWw6IChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8g5Zug572R57uc6Zeu6aKYXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC8vIC8vIOiOt+WPlueUqOaIt+S/oeaBr1xuICAgICAgICAgICAgLy8gd3guZ2V0U2V0dGluZyh7XG4gICAgICAgICAgICAvLyBcdHN1Y2Nlc3M6IHJlcyA9PiB7XG4gICAgICAgICAgICAvLyBcdFx0aWYgKHJlcy5hdXRoU2V0dGluZ1snc2NvcGUudXNlckluZm8nXSkge1xuICAgICAgICAgICAgLy8gXHRcdFx0Ly8g5bey57uP5o6I5p2D77yM5Y+v5Lul55u05o6l6LCD55SoIGdldFVzZXJJbmZvIOiOt+WPluWktOWDj+aYteensO+8jOS4jeS8muW8ueahhlxuICAgICAgICAgICAgLy8gXHRcdFx0d3guZ2V0VXNlckluZm8oe1xuICAgICAgICAgICAgLy8gXHRcdFx0XHRzdWNjZXNzOiByZXMgPT4ge1xuICAgICAgICAgICAgLy8gXHRcdFx0XHRcdC8vIOWPr+S7peWwhiByZXMg5Y+R6YCB57uZ5ZCO5Y+w6Kej56CB5Ye6IHVuaW9uSWRcbiAgICAgICAgICAgIC8vIFx0XHRcdFx0XHR0aGlzLmdsb2JhbERhdGEudXNlckluZm8gPSByZXMudXNlckluZm9cblxuICAgICAgICAgICAgLy8gXHRcdFx0XHRcdC8vIOeUseS6jiBnZXRVc2VySW5mbyDmmK/nvZHnu5zor7fmsYLvvIzlj6/og73kvJrlnKggUGFnZS5vbkxvYWQg5LmL5ZCO5omN6L+U5ZueXG4gICAgICAgICAgICAvLyBcdFx0XHRcdFx0Ly8g5omA5Lul5q2k5aSE5Yqg5YWlIGNhbGxiYWNrIOS7pemYsuatoui/meenjeaDheWGtVxuICAgICAgICAgICAgLy8gXHRcdFx0XHRcdGlmICh0aGlzLnVzZXJJbmZvUmVhZHlDYWxsYmFjaykge1xuICAgICAgICAgICAgLy8gXHRcdFx0XHRcdFx0dGhpcy51c2VySW5mb1JlYWR5Q2FsbGJhY2socmVzKVxuICAgICAgICAgICAgLy8gXHRcdFx0XHRcdH1cbiAgICAgICAgICAgIC8vIFx0XHRcdFx0fSxcbiAgICAgICAgICAgIC8vIFx0XHRcdH0pXG4gICAgICAgICAgICAvLyBcdFx0fVxuICAgICAgICAgICAgLy8gXHR9LFxuICAgICAgICAgICAgLy8gfSlcbiAgICAgICAgfSlcblxuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICog6K6+572udXNlcmluZm/nvJPlrZhcbiAgICAgKiBAcGFyYW0gdXNlckluZm8gXG4gICAgICovXG4gICAgc3RhdGljIHNldFVzZXJJbmZvU3RvcmFnZSh1c2VySW5mbzogQ3VzdG9tVXNlckluZm8pOiB2b2lkIHtcbiAgICAgICAgY29uc3Qgb1VzZXJJbmZvID0gdGhpcy5nZXRVc2VySW5mb1N0b3JhZ2UoKTtcbiAgICAgICAgY29uc3QgblVzZXJJbmZvID0ge1xuICAgICAgICAgICAgLi4ub1VzZXJJbmZvLFxuICAgICAgICAgICAgLi4udXNlckluZm9cbiAgICAgICAgfVxuICAgICAgICBkZWxldGUgblVzZXJJbmZvWyd1c2VybmFtZSddO1xuICAgICAgICB3eC5zZXRTdG9yYWdlU3luYygnVVNFUklORk8nLCBuVXNlckluZm8pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIOiOt+WPlm9wZW5pZF9zZXNzaW9uS2V557yT5a2YXG4gICAgICovXG4gICAgc3RhdGljIGdldE9wZW5pZFNlc3Npb25LZXlTdG9yYWdlKCk6IE9wZW5pZF9TZXNzaW9uS2V5VHlwZSB7XG4gICAgICAgIHJldHVybiB3eC5nZXRTdG9yYWdlU3luYygnT1BFTklEX1NFU1NJT05LRVknKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiDorr7nva5vcGVuaWRfc2Vzc2lvbktleee8k+WtmFxuICAgICAqIEBwYXJhbSBvcGVuaWRfc2Vzc2lvbktleSBcbiAgICAgKi9cbiAgICBzdGF0aWMgc2V0T3BlbmlkU2Vzc2lvbktleVN0b3JhZ2Uob3BlbmlkX3Nlc3Npb25LZXk6IE9wZW5pZF9TZXNzaW9uS2V5VHlwZSk6IHZvaWQge1xuICAgICAgICBjb25zdCBvT3BlbmlkX3Nlc3Npb25LZXkgPSB0aGlzLmdldE9wZW5pZFNlc3Npb25LZXlTdG9yYWdlKCk7XG4gICAgICAgIGNvbnN0IG5PcGVuaWRfc2Vzc2lvbktleSA9IHtcbiAgICAgICAgICAgIC4uLm9PcGVuaWRfc2Vzc2lvbktleSxcbiAgICAgICAgICAgIC4uLm9wZW5pZF9zZXNzaW9uS2V5XG4gICAgICAgIH07XG4gICAgICAgIHd4LnNldFN0b3JhZ2VTeW5jKCdPUEVOSURfU0VTU0lPTktFWScsIG5PcGVuaWRfc2Vzc2lvbktleSk7XG4gICAgfVxuXG5cbiAgICAvKipcbiAgICAgKiDojrflj5Z1c2VyaW5mb+e8k+WtmFxuICAgICAqL1xuICAgIHN0YXRpYyBnZXRVc2VySW5mb1N0b3JhZ2UoKTogQ3VzdG9tVXNlckluZm8ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIHd4LmdldFN0b3JhZ2VTeW5jKCdVU0VSSU5GTycpXG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1VTRVJJTkZP5o+Q5Y+W5aSx6LSlJywgZXJyKTtcbiAgICAgICAgICAgIHJldHVybiB7fVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5o+Q5Y+W57yT5a2Y5Lit55qEdXNlckluZm8o5LiN5YyF5ousb3Blbl9pZClcbiAgICAgKi9cbiAgICBzdGF0aWMgZ2V0VXNlckluZm8oKTogR2V0VXNlckluZm9SZXN1bHQge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbGV0IHVzZXJJbmZvID0gd3guZ2V0U3RvcmFnZVN5bmMoJ3VzZXJJbmZvJyk7XG4gICAgICAgICAgICBpZiAodXNlckluZm8gIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgdXNlckluZm8gPSBKU09OLnBhcnNlKHVzZXJJbmZvKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdXNlckluZm8gPSB7fTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB1c2VySW5mby51c2VySW5mbztcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5a2Y5YKodXNlckluZm8o5LiN5YyF5ousb3Blbl9pZCnvvIzlop7ph4/lrZjlgqjjgILnsbvkvLzkuo50aGlzLnNlckRhdGFcbiAgICAgKiBAcGFyYW0gdXNlckluZm8gXG4gICAgICovXG4gICAgc3RhdGljIHNldFVzZXJJbmZvKHVzZXJJbmZvOiBXZWNoYXRNaW5pcHJvZ3JhbS5Vc2VySW5mbykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3Qgb2xkSW5mbyA9IHRoaXMuZ2V0VXNlckluZm8oKSB8fCB7fTtcbiAgICAgICAgICAgIGNvbnN0IG5ld1VzZXJJbmZvID0ge1xuICAgICAgICAgICAgICAgIC4uLm9sZEluZm8sXG4gICAgICAgICAgICAgICAgdXNlckluZm9cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHd4LnNldFN0b3JhZ2VTeW5jKCd1c2VySW5mbycsIEpTT04uc3RyaW5naWZ5KG5ld1VzZXJJbmZvKSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgfVxuXG4gICAgfVxufVxuXG5cblxuZXhwb3J0IGRlZmF1bHQgVXNlcjtcbiJdfQ==