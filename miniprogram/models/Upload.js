"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var User_1 = __importDefault(require("./User"));
var util_1 = require("../utils/util");
var qiniuUploader = require('../utils/qiniuUploader');
function initQiniu() {
    var options = {
        region: 'NCN',
        uptoken: '',
        uptokenURL: 'https://jellyfishmix.com/wx-interchange/file/get_upload_token',
        uptokenFunc: function () { },
        domain: 'https://wx-interchange.oss.jellyfishmix.com',
        shouldUseQiniuFileName: true
    };
    qiniuUploader.init(options);
}
var Upload = (function () {
    function Upload() {
    }
    Upload.uploadLocalImg = function (imgObject) {
        return new Promise(function (resolve, reject) {
            initQiniu();
            console.log(imgObject);
            var userInfo = User_1.default.getUserInfoStorage();
            var filePath = imgObject.tempFilePaths[0];
            var chunks = filePath.split('.');
            var time = util_1.getTime(userInfo.nickName);
            var fileName = userInfo.nickName + "_" + time + "." + chunks[chunks.length - 1];
            qiniuUploader.upload(filePath, function (res) {
                resolve(res);
            }, function (error) {
                reject(error);
            }, null, function (progress) {
            }, function (cancelTask) {
                console.log('中断上传', cancelTask);
            });
        });
    };
    Upload.uploadMessageFile = function (fileObject) {
        return new Promise(function (resolve, reject) {
            initQiniu();
            var filePath = fileObject.path;
            var fileName = fileObject.name;
            qiniuUploader.upload(filePath, function (res) {
                resolve(res);
            }, function (error) {
                console.error('error: ' + JSON.stringify(error));
                reject(error);
            }, null, function (progress) {
                console.log('上传进程为', progress);
            }, function (cancelTask) {
                console.log('中断上传', cancelTask);
            });
        });
    };
    return Upload;
}());
exports.default = Upload;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXBsb2FkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiVXBsb2FkLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsZ0RBQTBCO0FBQzFCLHNDQUF3QztBQUd4QyxJQUFNLGFBQWEsR0FBRyxPQUFPLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQUl4RCxTQUFTLFNBQVM7SUFDZCxJQUFJLE9BQU8sR0FBRztRQUVWLE1BQU0sRUFBRSxLQUFLO1FBSWIsT0FBTyxFQUFFLEVBQUU7UUFFWCxVQUFVLEVBQUUsK0RBQStEO1FBRTNFLFdBQVcsRUFBRSxjQUFjLENBQUM7UUFHNUIsTUFBTSxFQUFFLDZDQUE2QztRQUVyRCxzQkFBc0IsRUFBRSxJQUFJO0tBQy9CLENBQUM7SUFFRixhQUFhLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ2hDLENBQUM7QUFFRDtJQUFBO0lBZ0ZBLENBQUM7SUF6RVUscUJBQWMsR0FBckIsVUFBc0IsU0FBNkQ7UUFDL0UsT0FBTyxJQUFJLE9BQU8sQ0FBQyxVQUFDLE9BQU8sRUFBRSxNQUFNO1lBRS9CLFNBQVMsRUFBRSxDQUFDO1lBRVosT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN2QixJQUFNLFFBQVEsR0FBRyxjQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUUzQyxJQUFJLFFBQVEsR0FBRyxTQUFTLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFDLElBQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDbkMsSUFBTSxJQUFJLEdBQUcsY0FBTyxDQUFDLFFBQVEsQ0FBQyxRQUFTLENBQUMsQ0FBQztZQUN6QyxJQUFJLFFBQVEsR0FBTSxRQUFRLENBQUMsUUFBUSxTQUFJLElBQUksU0FBSSxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUcsQ0FBQztZQUczRSxhQUFhLENBQUMsTUFBTSxDQUNoQixRQUFRLEVBQ1IsVUFBQyxHQUF5QjtnQkFDdEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2pCLENBQUMsRUFDRCxVQUFDLEtBQVU7Z0JBRVAsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2xCLENBQUMsRUFDRCxJQUFJLEVBQ0osVUFBQyxRQUFhO1lBRWQsQ0FBQyxFQUVELFVBQUMsVUFBZTtnQkFDWixPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxVQUFVLENBQUMsQ0FBQztZQUNwQyxDQUFDLENBQ0osQ0FBQztRQUNOLENBQUMsQ0FBQyxDQUFBO0lBQ04sQ0FBQztJQU9NLHdCQUFpQixHQUF4QixVQUF5QixVQUF3QztRQUM3RCxPQUFPLElBQUksT0FBTyxDQUFDLFVBQUMsT0FBTyxFQUFFLE1BQU07WUFFL0IsU0FBUyxFQUFFLENBQUM7WUFFWixJQUFNLFFBQVEsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDO1lBQ2pDLElBQU0sUUFBUSxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUM7WUFDakMsYUFBYSxDQUFDLE1BQU0sQ0FDaEIsUUFBUSxFQUNSLFVBQUMsR0FBUTtnQkFDTCxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDakIsQ0FBQyxFQUNELFVBQUMsS0FBVTtnQkFDUCxPQUFPLENBQUMsS0FBSyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ2pELE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNsQixDQUFDLEVBQ0QsSUFBSSxFQUNKLFVBQUMsUUFBYTtnQkFDVixPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztZQUtuQyxDQUFDLEVBQ0QsVUFBQyxVQUFlO2dCQUNaLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBQ3BDLENBQUMsQ0FDSixDQUFDO1FBQ04sQ0FBQyxDQUFDLENBQUE7SUFFTixDQUFDO0lBR0wsYUFBQztBQUFELENBQUMsQUFoRkQsSUFnRkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVXNlciBmcm9tICcuL1VzZXInO1xuaW1wb3J0IHsgZ2V0VGltZSB9IGZyb20gJy4uL3V0aWxzL3V0aWwnO1xuaW1wb3J0IHsgUWluaXVVcGxvYWRlclJlc0RhdGEgfSBmcm9tICcuLi91dGlscy90eXBpbmcnO1xuXG5jb25zdCBxaW5pdVVwbG9hZGVyID0gcmVxdWlyZSgnLi4vdXRpbHMvcWluaXVVcGxvYWRlcicpO1xuXG5cbi8vIOWIneWni+WMluS4g+eJm+S6keebuOWFs+mFjee9rlxuZnVuY3Rpb24gaW5pdFFpbml1KCkge1xuICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICAvLyBidWNrZXTmiYDlnKjljLrln5/vvIzov5nph4zmmK/ljY7ljJfljLrjgIJFQ04sIFNDTiwgTkNOLCBOQSwgQVNH77yM5YiG5Yir5a+55bqU5LiD54mb5LqR55qE77ya5Y2O5Lic77yM5Y2O5Y2X77yM5Y2O5YyX77yM5YyX576O77yM5paw5Yqg5Z2hIDUg5Liq5Yy65Z+fXG4gICAgICAgIHJlZ2lvbjogJ05DTicsXG5cbiAgICAgICAgLy8g6I635Y+WdXB0b2tlbuaWueazleS4iemAieS4gOWNs+WPr++8jOaJp+ihjOS8mOWFiOe6p+S4uu+8mnVwdG9rZW4gPiB1cHRva2VuVVJMID4gdXB0b2tlbkZ1bmPjgILkuInpgInkuIDvvIzliankuIvkuKTkuKrnva7nqbrjgILmjqjojZDkvb/nlKh1cHRva2VuVVJM77yM6K+m5oOF6K+36KeBIFJFQURNRS5tZFxuICAgICAgICAvLyDnlLHlhbbku5bnqIvluo/nlJ/miJDkuIPniZsgdXB0b2tlblxuICAgICAgICB1cHRva2VuOiAnJyxcbiAgICAgICAgLy8g5LuO5oyH5a6aIHVybCDpgJrov4cgSFRUUCBHRVQg6I635Y+WIHVwdG9rZW7vvIzov5Tlm57nmoTmoLzlvI/lv4XpobvmmK8ganNvbiDkuJTljIXlkKsgdXB0b2tlbiDlrZfmrrXvvIzkvovlpoLvvJoge1widXB0b2tlblwiOiBcIjBNTHZXUG55eS4uLlwifVxuICAgICAgICB1cHRva2VuVVJMOiAnaHR0cHM6Ly9qZWxseWZpc2htaXguY29tL3d4LWludGVyY2hhbmdlL2ZpbGUvZ2V0X3VwbG9hZF90b2tlbicsXG4gICAgICAgIC8vIHVwdG9rZW5GdW5jIOi/meS4quWxnuaAp+eahOWAvOWPr+S7peaYr+S4gOS4queUqOadpeeUn+aIkHVwdG9rZW7nmoTlh73mlbDvvIzor6bmg4Xor7fop4EgUkVBRE1FLm1kXG4gICAgICAgIHVwdG9rZW5GdW5jOiBmdW5jdGlvbiAoKSB7IH0sXG5cbiAgICAgICAgLy8gYnVja2V0IOWklumTvuWfn+WQje+8jOS4i+i9vei1hOa6kOaXtueUqOWIsOOAguWmguaenOiuvue9ru+8jOS8muWcqCBzdWNjZXNzIGNhbGxiYWNrIOeahCByZXMg5Y+C5pWw5Yqg5LiK5Y+v5Lul55u05o6l5L2/55So55qEIGZpbGVVcmwg5a2X5q6144CC5ZCm5YiZ6ZyA6KaB6Ieq5bex5ou85o6lXG4gICAgICAgIGRvbWFpbjogJ2h0dHBzOi8vd3gtaW50ZXJjaGFuZ2Uub3NzLmplbGx5ZmlzaG1peC5jb20nLFxuICAgICAgICAvLyDlpoLmnpzmmK8gdHJ1Ze+8jOWImeaWh+S7tueahCBrZXkg55SxIHFpbml1IOacjeWKoeWZqOWIhumFjSAo5YWo5bGA5Y676YeNKeOAguWmguaenOaYryBmYWxzZe+8jOWImeaWh+S7tueahCBrZXkg5L2/55So5b6u5L+h6Ieq5Yqo55Sf5oiQ55qEIGZpbGVuYW1l44CC6buY6K6k5pivIHRydWXjgILlu7rorq7kvb/nlKh0cnVl77yM5b6u5L+h6Ieq5Yqo55Sf5oiQ55qEZmlsZW5hbWXmnYLkubHkuJTplb9cbiAgICAgICAgc2hvdWxkVXNlUWluaXVGaWxlTmFtZTogdHJ1ZVxuICAgIH07XG4gICAgLy8g5bCG5LiD54mb5LqR55u45YWz6YWN572u5Yid5aeL5YyW6L+b5pysc2RrXG4gICAgcWluaXVVcGxvYWRlci5pbml0KG9wdGlvbnMpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBVcGxvYWQge1xuXG5cbiAgICAvKipcbiAgICAgKiDkuIrkvKDmnKzlnLDlm77niYdcbiAgICAgKiBAcGFyYW0gaW1nT2JqZWN0IFxuICAgICAqL1xuICAgIHN0YXRpYyB1cGxvYWRMb2NhbEltZyhpbWdPYmplY3Q6IFdlY2hhdE1pbmlwcm9ncmFtLkNob29zZUltYWdlU3VjY2Vzc0NhbGxiYWNrUmVzdWx0KSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICAvLyDliJ3lp4vljJbkuIPniZvkupHphY3nva5cbiAgICAgICAgICAgIGluaXRRaW5pdSgpO1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhpbWdPYmplY3QpO1xuICAgICAgICAgICAgY29uc3QgdXNlckluZm8gPSBVc2VyLmdldFVzZXJJbmZvU3RvcmFnZSgpO1xuXG4gICAgICAgICAgICB2YXIgZmlsZVBhdGggPSBpbWdPYmplY3QudGVtcEZpbGVQYXRoc1swXTtcbiAgICAgICAgICAgIGNvbnN0IGNodW5rcyA9IGZpbGVQYXRoLnNwbGl0KCcuJyk7XG4gICAgICAgICAgICBjb25zdCB0aW1lID0gZ2V0VGltZSh1c2VySW5mby5uaWNrTmFtZSEpO1xuICAgICAgICAgICAgdmFyIGZpbGVOYW1lID0gYCR7dXNlckluZm8ubmlja05hbWV9XyR7dGltZX0uJHtjaHVua3NbY2h1bmtzLmxlbmd0aCAtIDFdfWA7XG5cbiAgICAgICAgICAgIC8vIOWQkeS4g+eJm+S6keS4iuS8oFxuICAgICAgICAgICAgcWluaXVVcGxvYWRlci51cGxvYWQoXG4gICAgICAgICAgICAgICAgZmlsZVBhdGgsXG4gICAgICAgICAgICAgICAgKHJlczogUWluaXVVcGxvYWRlclJlc0RhdGEpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShyZXMpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgKGVycm9yOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ+S4iuS8oOacrOWcsOWbvueJh+mUmeivrycsIGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgKHByb2dyZXNzOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ+S4iuS8oOi/m+eoiycsIHByb2dyZXNzKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIC8vIChjYW5jZWxUYXNrOiBhbnkpID0+IHRoYXQuc2V0RGF0YSh7IGNhbmNlbFRhc2sgfSlcbiAgICAgICAgICAgICAgICAoY2FuY2VsVGFzazogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfkuK3mlq3kuIrkvKAnLCBjYW5jZWxUYXNrKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9KVxuICAgIH1cblxuXG4gICAgLyoqXG4gICAgICog5LiK5Lyg6IGK5aSp5paH5Lu2XG4gICAgICogQHBhcmFtIGltZ09iamVjdCBcbiAgICAgKi9cbiAgICBzdGF0aWMgdXBsb2FkTWVzc2FnZUZpbGUoZmlsZU9iamVjdDogV2VjaGF0TWluaXByb2dyYW0uQ2hvb3NlRmlsZSkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgLy8g5Yid5aeL5YyW5LiD54mb5LqR55u45YWz5Y+C5pWwXG4gICAgICAgICAgICBpbml0UWluaXUoKTtcbiAgICAgICAgICAgIC8vIOW+ruS/oSBBUEkg6YCJ5oup5paH5Lu2XG4gICAgICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGZpbGVPYmplY3QucGF0aDtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVOYW1lID0gZmlsZU9iamVjdC5uYW1lO1xuICAgICAgICAgICAgcWluaXVVcGxvYWRlci51cGxvYWQoXG4gICAgICAgICAgICAgICAgZmlsZVBhdGgsXG4gICAgICAgICAgICAgICAgKHJlczogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChlcnJvcjogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2Vycm9yOiAnICsgSlNPTi5zdHJpbmdpZnkoZXJyb3IpKTtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgKHByb2dyZXNzOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+S4iuS8oOi/m+eoi+S4uicsIHByb2dyZXNzKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygn5LiK5Lyg6L+b5bqmJywgcHJvZ3Jlc3MucHJvZ3Jlc3MpO1xuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygn5bey57uP5LiK5Lyg55qE5pWw5o2u6ZW/5bqmJywgcHJvZ3Jlc3MudG90YWxCeXRlc1NlbnQpO1xuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygn6aKE5pyf6ZyA6KaB5LiK5Lyg55qE5pWw5o2u5oC76ZW/5bqmJywgcHJvZ3Jlc3MudG90YWxCeXRlc0V4cGVjdGVkVG9TZW5kKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIChjYW5jZWxUYXNrOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+S4reaWreS4iuS8oCcsIGNhbmNlbFRhc2spO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0pXG5cbiAgICB9XG5cblxufVxuXG4iXX0=